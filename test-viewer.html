<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>State Machine Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <style>
      body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
}
.container {
  max-width: 100%;
  margin: 0 auto;
}
h1 {
  color: white;
  text-align: center;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}
.subtitle {
  color: rgba(255, 255, 255, 0.9);
  text-align: center;
  margin-bottom: 30px;
  font-size: 14px;
}
.controls {
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
}
button {
  padding: 10px 20px;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.3s ease;
}
button:hover {
  background: #5568d3;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}
button:active {
  transform: translateY(0);
}
#diagram-container {
  background: white;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  overflow: visible;
  width: 90%;
  max-width: 1400px;
  height: 700px;
  margin: 0 auto;
  position: relative;
}
#diagram-container svg {
  width: 100%;
  height: 100%;
}
.mermaid {
  width: 100%;
  height: 100%;
}
.footer {
  text-align: center;
  color: rgba(255, 255, 255, 0.8);
  margin-top: 30px;
  font-size: 12px;
}

    </style>
  </head>
  <body>
    <div class="container">
      <h1>State Machine Diagram</h1>
      <p class="subtitle">Generated by Robot to FSM Generator</p>

      <!-- <div class="controls"> -->
      <!--   <button onclick="downloadSVG()" title="Download SVG"> -->
      <!--     ðŸ’¾ Download SVG -->
      <!--   </button> -->
      <!--   <button onclick="downloadPNG()" title="Download PNG"> -->
      <!--     ðŸ“· Download PNG -->
      <!--   </button> -->
      <!-- </div> -->

      <div id="diagram-container">
        <div class="mermaid">stateDiagram-v2
    [*] --> Idle
    Idle --> Processing : start_process
    Idle --> ConfigMode : enter_config
    Processing --> Validating : validate
    Processing --> Error : validation_failed
    Processing --> Idle : cancel
    Validating --> Success : validation_passed
    Validating --> Error : validation_failed
    Validating --> Processing : retry
    Success --> Idle : reset
    Success --> ExportData : export
    ExportData --> Idle : export_complete
    ExportData --> Error : export_failed
    Error --> Idle : acknowledge
    Error --> Processing : retry
    ConfigMode --> Idle : save_config
    ConfigMode --> Idle : cancel_config
    note right of Processing
        This state handles the main processing logic
    end note
    note right of Error
        Errors can be retried or acknowledged
    end note</div>
      </div>
    </div>

    <script>
      mermaid.initialize({
  startOnLoad: true,
  theme: "default",
  securityLevel: "loose",
  flowchart: {
    useMaxWidth: false,
  },
});

let panZoomInstance = null;

// Initialize svg-pan-zoom after mermaid renders
window.addEventListener("load", () => {
  setTimeout(() => {
    const svg = document.querySelector("#diagram-container svg");
    console.log(svg);
    if (svg && typeof svgPanZoom !== "undefined") {
      panZoomInstance = svgPanZoom(svg, {
        zoomEnabled: true,
        controlIconsEnabled: true,
        fit: true,
        center: true,
        minZoom: 0.3,
        maxZoom: 10,
        zoomScaleSensitivity: 0.3,
        dblClickZoomEnabled: true,
        mouseWheelZoomEnabled: true,
        preventMouseEventsDefault: true,
        contain: false,
      });
    }
  }, 500);
});

function downloadSVG() {
  const svg = document.querySelector("#diagram-container svg");
  if (svg) {
    const serializer = new XMLSerializer();
    const svgString = serializer.serializeToString(svg);
    const blob = new Blob([svgString], { type: "image/svg+xml" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "state-machine.svg";
    a.click();
    URL.revokeObjectURL(url);
  }
}

function downloadPNG() {
  const svg = document.querySelector("#diagram-container svg");
  if (svg) {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    const svgData = new XMLSerializer().serializeToString(svg);
    const img = new Image();

    img.onload = function () {
      canvas.width = img.width * 2;
      canvas.height = img.height * 2;
      ctx.fillStyle = "white";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      canvas.toBlob(function (blob) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "state-machine.png";
        a.click();
        URL.revokeObjectURL(url);
      });
    };

    img.src =
      "data:image/svg+xml;base64," +
      btoa(unescape(encodeURIComponent(svgData)));
  }
}

    </script>
  </body>
</html>
